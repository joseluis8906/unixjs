cedeg=(function(){var b;function c(d,e){Gwt.Gui.HBox.call(this,0);this.SetSize(d,e);this.SetClassName("record_widget");this.code=new Gwt.Gui.Entry("Código");this.code.SetExpand(false);this.code.SetWidth(120);this.name=new Gwt.Gui.StaticText("Nombre");this.name.SetExpand(false);this.name.SetWidth(this.GetWidth()-480);this.name.SetValign(Gwt.Gui.Contrib.Valign.Middle);this.partial=new Gwt.Gui.Entry("Parcial");this.partial.SetExpand(false);this.partial.SetWidth(120);this.partial.ChangeToMonetary();this.debit=new Gwt.Gui.Entry("Debe");this.debit.SetExpand(false);this.debit.SetWidth(120);this.debit.ChangeToMonetary();this.credit=new Gwt.Gui.Entry("Haber");this.credit.SetExpand(false);this.credit.SetWidth(120);this.credit.ChangeToMonetary();this.Add(this.code);this.Add(this.name);this.Add(this.partial);this.Add(this.debit);this.Add(this.credit);this.code.AddEvent(Gwt.Gui.Event.Keyboard.KeyPress,this.check_code.bind(this))}c.prototype=new Gwt.Gui.HBox();c.prototype.constructor=c;c.prototype._record_widget=function(){this.code._Entry();this.name._StaticText();this.partial._Entry();this.debit._Entry();this.credit._Entry();this.code=null;this.name=null;this.partial=null;this.debit=null;this.credit=null};c.prototype.Reset=function(){this.code.Reset();this.name.SetText("Nombre");this.partial.Reset();this.debit.Reset();this.credit.Reset()};c.prototype.check_code=function(e){if(e.keyCode===Gwt.Gui.Event.Keyboard.KeyCodes.Enter){var d='SELECT "Name" FROM "AccountingAccount" WHERE "Code"=\'{0}\''.replace("{0}",this.code.GetText());new Gwt.Core.SqlQuery(d,this.autocomplete.bind(this))}};c.prototype.autocomplete=function(d){if(d.Data.length>0){this.name.SetText(d.Data[0].Name)}else{this.name.SetText("Nombre")}};function a(){Gwt.Gui.Window.call(this,"Comprobante De Egreso");this.SetSize(840,460);this.SetPosition(Gwt.Gui.WIN_POS_CENTER);this.SetBorderSpacing(12);this.EnableMenu();this.AddMenuItem(Gwt.Core.Contrib.Images+"appbar.cabinet.in.svg","Guardar",this.Save.bind(this));this.AddMenuItem(Gwt.Core.Contrib.Images+"appbar.delete.svg","Eliminar",this.Delete.bind(this));this.AddMenuItem(Gwt.Core.Contrib.Images+"appbar.power.svg","Salir",function(){window.cedeg.close();window.gcontrol.open()},Gwt.Gui.MENU_QUIT_APP);this.layout=new Gwt.Gui.VBox();this.SetLayout(this.layout);this.slider=new Gwt.Gui.Slider(3);this.slider.SetSize(this.layout.GetWidth(),this.layout.GetHeight());this.slider.Setup();this.number=new Gwt.Gui.Entry("Número");this.place=new Gwt.Gui.Entry("Lugar");this.date=new Gwt.Gui.Date("Creación");this.date.Now();this.holder=new Gwt.Gui.Entry("A Favor De");this.amount=new Gwt.Gui.Entry("Valor");this.amount.ChangeToMonetary();this.bank=new Gwt.Gui.Entry("Banco");this.check=new Gwt.Gui.Entry("Cheque");this.checking_account=new Gwt.Gui.Entry("Cuenta");this.concept=new Gwt.Gui.Text("Concepto");this.records=[];this.update=false;this.Report=null;this.layout.Add(this.slider);for(var d=0;d<20;d++){this.records[d]=new c(this.slider.GetWidth(),24)}this.slider.AddSlotWidget(0,this.number);this.slider.AddSlotWidget(0,this.place);this.slider.AddSlotWidget(0,this.date);this.slider.AddSlotWidget(0,this.holder);this.slider.AddSlotWidget(0,this.amount);this.slider.AddSlotWidget(0,this.bank);this.slider.AddSlotWidget(0,this.check);this.slider.AddSlotWidget(0,this.checking_account);this.slider.AddSlotWidget(0,this.concept);for(var d=0;d<this.records.length;d++){if(d<=9){this.slider.AddSlotWidget(1,this.records[d])}else{this.slider.AddSlotWidget(2,this.records[d])}}this.number.AddEvent(Gwt.Gui.Event.Keyboard.KeyPress,this.CheckNumber.bind(this))}a.prototype=new Gwt.Gui.Window();a.prototype.constructor=a;a.prototype._App=function(){this.number._Entry();this.place._Entry();this.date._Date();this.holder._Entry();this.amount._Entry();this.bank._Entry();this.check._Entry();this.checking_account._Entry();this.concept._Text();this.slider._Slider();this.Report===null?0:this.Report.close();this.number=null;this.place=null;this.date=null;this.holder=null;this.amount=null;this.bank=null;this.check=null;this.checking_account=null;this.concept=null;this.slider=null;for(var d=0;d<this.records.length;d++){this.records[d]._record_widget();this.records[d]=null}this.records=null;this.layout._VBox();this.layout=null;this.Report=null};a.prototype.Save=function(){var e='WITH "ins1" AS (INSERT INTO "AccountingDisbVou"("Number", "Place", "Date", "Holder", "Concept")VALUES(?, ?, ?, ?, ?) RETURNING "Id")INSERT INTO "AccountingDisbVouBank"("AccountingDisbVouId", "Bank", "Check", "CheckingAccount", "Amount")SELECT "Id", ?, ?, ?, ? FROM "ins1";\n';for(var d=0;d<this.records.length;d++){if(this.records[d].code.GetText()!==""){e+='INSERT INTO "AccountingDisbVouRecord"("AccountingDisbVouId", "AccountingAccountId", "Partial", "Debit", "Credit")SELECT "AccountingDisbVou"."Id", "AccountingAccount"."Id", ?, ?, ? FROM "AccountingDisbVou" INNER JOIN "AccountingAccount" ON "AccountingDisbVou"."Number"=? AND "AccountingAccount"."Code"=?;\n'}}var f=new Gwt.Core.PrepareStatement(e);f.SetNumber(this.number.GetText());f.SetString(this.place.GetText());f.SetString(this.date.GetText());f.SetString(this.holder.GetText());f.SetString(this.concept.GetText());f.SetString(this.bank.GetText());f.SetString(this.check.GetText());f.SetString(this.checking_account.GetText());f.SetNumber(this.amount.GetText());for(var d=0;d<this.records.length;d++){if(this.records[d].code.GetText()!==""){f.SetNumber(this.records[d].partial.GetText());f.SetNumber(this.records[d].debit.GetText());f.SetNumber(this.records[d].credit.GetText());f.SetNumber(this.number.GetText());f.SetString(this.records[d].code.GetText())}}new Gwt.Core.SqlStatement(f,this.SaveResponse.bind(this))};a.prototype.SaveResponse=function(d){if(d.Result===1){this.Report=Gwt.Core.Contrib.LoadDocument("/share/documents/cedeg.html");this.Report.addEventListener("load",this.ReportLoad.bind(this))}};a.prototype.Delete=function(){};a.prototype.Reset=function(){this.number.SetText("");this.place.SetText("");this.date.Now();this.holder.SetText("");this.amount.SetText("");this.bank.SetText("");this.check.SetText("");this.checking_account.SetText("");this.concept.SetText("");for(var d=0;d<this.records.length;d++){this.records[d].Reset()}};a.prototype.CheckNumber=function(d){if(d.keyCode===Gwt.Gui.Event.Keyboard.KeyCodes.Enter){if(this.number.GetText()===""){var e='SELECT "Number" FROM "AccountingDisbVou" ORDER BY "Number" DESC LIMIT 1';new Gwt.Core.SqlQuery(e,this.NextNumber.bind(this))}else{var e='SELECT "Number", "Place", "Date", "Holder", "Concept", "Bank", "Check", "CheckingAccount", "Amount", "Code", "Name", "Partial", "Debit", "Credit" FROM "AccountingDisbVouAll" WHERE "Number"=?'.replace("?",this.number.GetText());new Gwt.Core.SqlQuery(e,this.AutoFill.bind(this))}}};a.prototype.AutoFill=function(d){if(d.Data.length>0){this.number.SetText(d.Data[0].Number);this.place.SetText(d.Data[0].Place);this.date.SetDate(d.Data[0].Date);this.holder.SetText(d.Data[0].Holder);this.amount.SetText(d.Data[0].Amount);this.bank.SetText(d.Data[0].Bank);this.check.SetText(d.Data[0].Check);this.checking_account.SetText(d.Data[0].CheckingAccount);this.concept.SetText(d.Data[0].Concept);for(var e=0;e<d.Data.length;e++){this.records[e].code.SetText(d.Data[e].Code);this.records[e].name.SetText(d.Data[e].Name);this.records[e].partial.SetText(d.Data[e].Partial);this.records[e].debit.SetText(d.Data[e].Debit);this.records[e].credit.SetText(d.Data[e].Credit)}for(e;e<this.records.length;e++){this.records[e].Reset()}}else{this.Reset()}};a.prototype.NextNumber=function(d){this.number.SetText(Number(d.Data[0].Number)+1)};a.prototype.ReportLoad=function(){var f=this.Report.contentWindow.document;f.getElementById("Number").textContent=this.number.GetText();f.getElementById("Place").textContent=this.place.GetText()+", "+this.date.GetText();f.getElementById("Holder").textContent=this.holder.GetText();f.getElementById("AmountHuman").textContent=Gwt.Core.Contrib.NumberToHumanReadable(this.amount.GetText())+"PESOS MTE";f.getElementById("Bank").textContent=this.bank.GetText();f.getElementById("Check").textContent=this.check.GetText();f.getElementById("CheckingAccount").textContent=this.checking_account.GetText();f.getElementById("Concept").textContent=this.concept.GetText();f.getElementById("Amount").textContent=this.amount.GetText();var d=[];for(var e=0;e<this.records.length;e++){if(this.records[e].code.GetText()!==""){d.push({Code:this.records[e].code.GetText(),Name:this.records[e].name.GetText(),Partial:this.records[e].partial.GetText(),Debit:this.records[e].debit.GetText(),Credit:this.records[e].credit.GetText()})}}for(var e=0;e<d.length;e++){f.getElementById("Code"+e).textContent=d[e].Code;f.getElementById("Name"+e).textContent=d[e].Name;f.getElementById("Partial"+e).textContent=d[e].Partial;f.getElementById("Debit"+e).textContent=d[e].Debit;f.getElementById("Credit"+e).textContent=d[e].Credit}for(e;e<this.records.length;e++){f.getElementById("Code"+e).textContent="";f.getElementById("Name"+e).textContent="";f.getElementById("Partial"+e).textContent="";f.getElementById("Debit"+e).textContent="";f.getElementById("Credit"+e).textContent=""}f=undefined;this.Report=null;this.Reset()};return new function(){this.open=function(){if(b===undefined){b=new a();b.Open();Gwt.Core.Contrib.SetActiveApp(window.cedeg)}else{console.log("%app yet opened".replace("%app",b.__proto__.constructor.name))}};this.close=function(){if(b!==undefined){b.Close();b=undefined;Gwt.Core.Contrib.RemoveActiveApp()}}}})();