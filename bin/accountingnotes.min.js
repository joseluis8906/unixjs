accountingnotes=(function(){var a;function b(e,f){Gwt.Gui.HBox.call(this,0);this.SetSize(e,f);this.SetClassName("record_widget");this.Rpc=new Gwt.Core.Rpc("/accountingnotes/");this.code=new Gwt.Gui.Entry("Código");this.code.SetExpand(false);this.code.SetWidth(120);this.name=new Gwt.Gui.StaticText("Nombre");this.name.SetExpand(false);this.name.SetWidth(this.GetWidth()-360);this.name.SetValign(Gwt.Gui.Contrib.Valign.Middle);this.debit=new Gwt.Gui.Entry("Debe");this.debit.SetExpand(false);this.debit.SetWidth(120);this.debit.ChangeToMonetary();this.debit.TextAlign(Gwt.Gui.Contrib.TextAlign.Right);this.credit=new Gwt.Gui.Entry("Haber");this.credit.SetExpand(false);this.credit.SetWidth(120);this.credit.ChangeToMonetary();this.credit.TextAlign(Gwt.Gui.Contrib.TextAlign.Right);this.Add(this.code);this.Add(this.name);this.Add(this.debit);this.Add(this.credit);this.code.AddEvent(Gwt.Gui.Event.Keyboard.KeyPress,this.check_code.bind(this))}b.prototype=new Gwt.Gui.HBox();b.prototype.constructor=b;b.prototype._record_widget=function(){this.code._Entry();this.name._StaticText();this.debit._Entry();this.credit._Entry();this.code=null;this.name=null;this.debit=null;this.credit=null};b.prototype.Reset=function(){this.code.Reset();this.name.SetText("Nombre");this.debit.Reset();this.credit.Reset()};b.prototype.check_code=function(e){if(e.keyCode===Gwt.Gui.Event.Keyboard.KeyCodes.Enter){this.Rpc.Send({Method:"CheckCode",Code:this.code.GetText()},this.autocomplete.bind(this))}};b.prototype.autocomplete=function(e){if(e.length>0){this.name.SetText(e[0].Name)}else{this.name.SetText("Nombre")}};function d(e,f){Gwt.Gui.HBox.call(this,0);this.SetSize(e,f);this.SetClassName("equal_sums_widget");this.label=new Gwt.Gui.StaticText("Sumas Iguales");this.label.SetExpand(false);this.label.SetWidth(this.GetWidth()-240);this.label.SetValign(Gwt.Gui.Contrib.Valign.Middle);this.debit=new Gwt.Gui.Entry("Debe");this.debit.SetExpand(false);this.debit.SetWidth(120);this.debit.ChangeToMonetary();this.debit.TextAlign(Gwt.Gui.Contrib.TextAlign.Right);this.credit=new Gwt.Gui.Entry("Haber");this.credit.SetExpand(false);this.credit.SetWidth(120);this.credit.ChangeToMonetary();this.credit.TextAlign(Gwt.Gui.Contrib.TextAlign.Right);this.Add(this.label);this.Add(this.debit);this.Add(this.credit)}d.prototype=new Gwt.Gui.HBox();d.prototype.constructor=d;d.prototype.set_debit=function(e){this.debit.SetText(e)};d.prototype.set_credit=function(e){this.debit.SetText(e)};function c(){Gwt.Gui.Window.call(this,"Nota Contable");this.SetSize(840,508);this.SetPosition(Gwt.Gui.WIN_POS_CENTER);this.SetBorderSpacing(12);this.Rpc=new Gwt.Core.Rpc("/accountingnotes/");this.EnableMenu();this.AddMenuItem(Gwt.Core.Contrib.Images+"appbar.cabinet.in.svg","Guardar",this.Insert.bind(this));this.AddMenuItem(Gwt.Core.Contrib.Images+"appbar.refresh.svg","Actualizar",this.Update.bind(this));this.AddMenuItem(Gwt.Core.Contrib.Images+"appbar.delete.svg","Eliminar",this.Delete.bind(this));this.AddMenuItem(Gwt.Core.Contrib.Images+"appbar.printer.svg","Imprimir",this.Print.bind(this));this.AddMenuItem(Gwt.Core.Contrib.Images+"appbar.power.svg","Salir",function(){window.accountingnotes.close();window.gcontrol.open()},Gwt.Gui.MENU_QUIT_APP);this.layout=new Gwt.Gui.VBox();this.SetLayout(this.layout);this.slider=new Gwt.Gui.Slider(5);this.slider.SetSize(this.layout.GetWidth(),this.layout.GetHeight()-48);this.slider.Setup();this.layout.Add(this.slider);this.equal_sums=new d(this.layout.GetWidth(),48);this.layout.Add(this.equal_sums);this.number=new Gwt.Gui.Entry("Número");this.date=new Gwt.Gui.Date("Creación");this.date.Now();this.concept=new Gwt.Gui.Text("Concepto");this.Report=null;this.records=[];for(var e=0;e<=45;e++){this.records[e]=new b(this.slider.GetWidth(),24);this.records[e].debit.AddEvent(Gwt.Gui.Event.Form.Change,this.ChangeDebit.bind(this));this.records[e].credit.AddEvent(Gwt.Gui.Event.Form.Change,this.ChangeCredit.bind(this))}this.slider.AddSlotWidget(0,this.number);this.slider.AddSlotWidget(0,this.date);this.slider.AddSlotWidget(0,this.concept);for(var e=0;e<this.records.length;e++){if(e<=5){this.slider.AddSlotWidget(0,this.records[e])}else{if(e>=6&&e<=15){this.slider.AddSlotWidget(1,this.records[e])}else{if(e>=16&&e<=25){this.slider.AddSlotWidget(2,this.records[e])}else{if(e>=26&&e<=35){this.slider.AddSlotWidget(3,this.records[e])}else{if(e>=36&&e<=45){this.slider.AddSlotWidget(4,this.records[e])}}}}}}this.number.AddEvent(Gwt.Gui.Event.Keyboard.KeyPress,this.CheckNumber.bind(this))}c.prototype=new Gwt.Gui.Window();c.prototype.constructor=c;c.prototype._App=function(){this.number._Entry();this.date._Date();this.concept._Text();for(var e=0;e<this.records.length;e++){this.records[e]._record_widget();this.records[e]=null}this.slider._Slider();this.Report===null?null:this.Report.close();this.layout._VBox();this.number=null;this.date=null;this.concept=null;this.records=null;this.slider=null;this.layout=null;this.Report=null};c.prototype.ChangeDebit=function(){var e=0;for(var f=0;f<this.records.length;f++){e+=Number(this.records[f].debit.GetText())}this.equal_sums.set_debit(e)};c.prototype.ChangeCredit=function(){var e=0;for(var f=0;f<this.records.length;f++){e+=Number(this.records[f].credit.GetText())}this.equal_sums.set_credit(e)};c.prototype.CreateData=function(){var f={Number:this.number.GetText(),Date:this.date.GetText(),Concept:this.concept.GetText()};f.Records=[];for(var e=0;e<this.records.length;e++){if(this.records[e].code.GetText()!==""){f.Records.push({Debit:(this.records[e].debit.GetText()==="")?0:this.records[e].debit.GetText(),Credit:(this.records[e].credit.GetText()==="")?0:this.records[e].credit.GetText(),Number:this.number.GetText(),Code:this.records[e].code.GetText()})}}return f};c.prototype.Insert=function(){var e=this.CreateData();e.Method="Insert";this.Rpc.Send(e,this.InsertResponse.bind(this))};c.prototype.InsertResponse=function(e){if(e.affected_rows===1){this.Print()}};c.prototype.Update=function(){var e=this.CreateData();e.Method="Update";console.log(e);this.Rpc.Send(e,this.UpdateResponse.bind(this))};c.prototype.UpdateResponse=function(e){if(e.affected_rows===1){this.Print()}};c.prototype.Delete=function(){this.Rpc.Send({Method:"Delete",Number:this.number.GetText()},this.DeleteResponse.bind(this))};c.prototype.DeleteResponse=function(e){if(e.affected_rows===1){this.Reset()}};c.prototype.Print=function(f){var e=0;for(var g=0;g<this.records.length;g++){if(this.records[g].code.GetText()!==""){e+=1}}this.Report=Gwt.Core.Contrib.LoadDocument("/documents/accountingnote.html?records=%0".replace("%0",e));this.Report.addEventListener("load",this.ReportLoad.bind(this))};c.prototype.ReportLoad=function(){var k=this.Report.contentWindow.document;k.getElementById("Number").textContent=Gwt.Core.Contrib.ZFill(this.number.GetText(),4);k.getElementById("Date").textContent=this.date.GetText();k.getElementById("Concept").textContent=this.concept.GetText();var f=0;var j=0;var e=[];for(var g=0;g<this.records.length;g++){if(this.records[g].code.GetText()!==""){f+=Number(this.records[g].debit.GetText());j+=Number(this.records[g].credit.GetText());e.push({Code:this.records[g].code.GetText(),Name:this.records[g].name.GetText(),Partial:Gwt.Core.Contrib.TextToMonetary(""),Debit:Gwt.Core.Contrib.TextToMonetary(this.records[g].debit.GetText()),Credit:Gwt.Core.Contrib.TextToMonetary(this.records[g].credit.GetText())})}}var h=this.SortData(e);for(var g=0;g<h.length;g++){k.getElementById("Code"+g).textContent=h[g].Code;k.getElementById("Name"+g).textContent=h[g].Name;k.getElementById("Partial"+g).textContent=(h[g].Partial==="$0")?"":h[g].Partial;k.getElementById("Debit"+g).textContent=(h[g].Debit==="$0")?"":h[g].Debit;k.getElementById("Credit"+g).textContent=(h[g].Credit==="$0")?"":h[g].Credit}k.getElementById("EqSumDebit").textContent=Gwt.Core.Contrib.TextToMonetary(f.toString());k.getElementById("EqSumCredit").textContent=Gwt.Core.Contrib.TextToMonetary(j.toString());k=undefined;this.Report=null;this.Reset()};c.prototype.CheckNumber=function(e){if(e.keyCode===Gwt.Gui.Event.Keyboard.KeyCodes.Enter){if(this.number.GetText()===""){this.Rpc.Send({Method:"NextNumber"},this.NextNumber.bind(this))}else{this.Rpc.Send({Method:"AutoFill",Number:this.number.GetText()},this.AutoFill.bind(this))}}};c.prototype.NextNumber=function(e){if(e.length>0){this.number.SetText(Number(e[0].Number)+1)}else{this.number.SetText(Number(1))}};c.prototype.AutoFill=function(e){if(e.length>0){this.number.SetText(e[0].Number);this.date.SetDate(e[0].Date);this.concept.SetText(e[0].Concept);for(var f=0;f<e.length;f++){this.records[f].code.SetText(e[f].Code);this.records[f].name.SetText(e[f].Name);this.records[f].debit.SetText((e[f].Debit===0?"":e[f].Debit));this.records[f].credit.SetText((e[f].Credit===0?"":e[f].Credit))}for(f;f<this.records.length;f++){this.records[f].Reset()}}else{this.Reset()}};c.prototype.Reset=function(){this.number.SetText("");this.date.Now();this.concept.SetText("");for(var e=0;e<this.records.length;e++){this.records[e].Reset()}};c.prototype.SortData=function(e){var l=[];var h=[];var f=[];for(var k=0;k<e.length;k++){if(Number(e[k].Debit)!==0){l.push(e[k])}else{if(Number(e[k].Credit)!==0){h.push(e[k])}}}for(var k=0;k<l.length;k++){for(var g=0;g<e.length;g++){if(e[g].Code.startsWith(l[k].Code)){f.push(e[g])}}}for(var k=0;k<h.length;k++){for(var g=0;g<e.length;g++){if(e[g].Code.startsWith(h[k].Code)){f.push(e[g])}}}return f};return new function(){this.open=function(){if(a===undefined){a=new c();a.Open();Gwt.Core.Contrib.SetActiveApp(window.accountingnotes)}else{console.log("%app yet opened".replace("%app",a.__proto__.constructor.name))}};this.close=function(){if(a!==undefined){a.Close();a=undefined;Gwt.Core.Contrib.RemoveActiveApp()}}}})();