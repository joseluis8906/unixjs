accountingrep=(function(){var a;function b(){Gwt.Gui.Window.call(this,"Reporte");this.SetSize(640,320);this.SetPosition(Gwt.Gui.WIN_POS_CENTER);this.SetBorderSpacing(12);this.Rpc=new Gwt.Core.Rpc("/accountingrep/");this.Records;this.EnableMenu();this.AddMenuItem(Gwt.Core.Contrib.Images+"appbar.printer.svg","Imprimir",this.Print.bind(this));this.AddMenuItem(Gwt.Core.Contrib.Images+"appbar.power.svg","Salir",function(){window.accountingrep.close();window.gcontrol.open()},Gwt.Gui.MENU_QUIT_APP);this.layout=new Gwt.Gui.VBox();this.SetLayout(this.layout);this.ReportType=new Gwt.Gui.IconSelectBox(Gwt.Core.Contrib.Images+"appbar.notification.star.svg","Tipo de Reporte",[{Text:"Comprobante de Diario",Value:"Daily"}]);this.layout.Add(this.ReportType);this.labelDateBegin=new Gwt.Gui.StaticText("Desde");this.labelDateBegin.SetExpand(true);this.layout.Add(this.labelDateBegin);this.dateBegin=new Gwt.Gui.Date("Inicio");this.dateBegin.Now();this.layout.Add(this.dateBegin);this.labelDateEnd=new Gwt.Gui.StaticText("Hasta");this.labelDateBegin.SetExpand(true);this.layout.Add(this.labelDateEnd);this.dateEnd=new Gwt.Gui.Date("Final");this.dateEnd.Now();this.layout.Add(this.dateEnd);this.Report=null}b.prototype=new Gwt.Gui.Window();b.prototype.constructor=b;b.prototype._App=function(){this.labelDateBegin._StaticText();this.dateBegin._Date();this.labelDateEnd._StaticText();this.dateEnd._Date();this.Report===null?null:this.Report.close();this.layout._VBox();this.labelDateBegin=null;this.dateBegin=null;this.labelDateEnd=null;this.dateEnd=null;this.layout=null;this.Report=null};b.prototype.CreateData=function(){var c={Method:this.ReportType.GetText(),DateBegin:this.dateBegin.GetText(),DateEnd:this.dateEnd.GetText()};return c};b.prototype.Print=function(){var c=this.CreateData();this.Rpc.Send(c,this.PrintResponse.bind(this))};b.prototype.PrintResponse=function(c){this.Records=this.SortData(c);this.Report=Gwt.Core.Contrib.LoadDocument("/documents/daily.html?records=%0".replace("%0",this.Records.length));this.Report.addEventListener("load",this.ReportLoad.bind(this))};b.prototype.ReportLoad=function(){var f=this.Report.contentWindow.document;var c=0;var e=0;for(var d=0;d<this.Records.length;d++){f.getElementById("Code"+d).textContent=this.Records[d].Code;f.getElementById("Name"+d).textContent=this.Records[d].Name;f.getElementById("Partial"+d).textContent=(this.Records[d].Partial==="$0")?"":this.Records[d].Partial;f.getElementById("Debit"+d).textContent=(this.Records[d].Debit==="$0")?"":this.Records[d].Debit;f.getElementById("Credit"+d).textContent=(this.Records[d].Credit==="$0")?"":this.Records[d].Credit;c+=Number(this.Records[d].Debit);e+=Number(this.Records[d].Credit)}f.getElementById("EqSumDebit").textContent=Gwt.Core.Contrib.TextToMonetary(c.toString());f.getElementById("EqSumCredit").textContent=Gwt.Core.Contrib.TextToMonetary(e.toString());f=undefined;this.Report=null;this.Reset()};b.prototype.Reset=function(){this.ReportType.SetText("");this.dateBegin.Now();this.dateEnd.Now()};b.prototype.SortData=function(c){var k=[];var g=[];var d=[];k=[];g=[];if(c.DisbVous.length>0){var f;for(var h=0;h<c.DisbVous.length;h++){if(Number(c.DisbVous[h].Debit)!==0){if(k.length>0){for(var e=0;e<k.length;e++){if(c.DisbVous[h].Code===k[e].Code){k[e].Debit+=c.DisbVous[h].Debit;break}if(e==k.length-1){k.push(c.DisbVous[h]);break}}}else{k.push(c.DisbVous[h])}f="Debit"}else{if(Number(c.DisbVous[h].Credit)!==0){if(g.length>0){for(var e=0;e<g.length;e++){if(c.DisbVous[h].Code===g[e].Code){g[e].Credit+=c.DisbVous[h].Credit;break}if(e==k.length-1){g.push(c.DisbVous[h]);break}}}else{g.push(c.DisbVous[h])}f="Credit"}else{if(f==="Debit"){for(var e=0;e<k.length;e++){if(c.DisbVous[h].Code===k[e].Code){k[e].Partial+=c.DisbVous[h].Partial;break}if(e==k.length-1){k.push(c.DisbVous[h]);break}}}else{if(f==="Credit"){for(var e=0;e<g.length;e++){if(c.DisbVous[h].Code===g[e].Code){g[e].Partial+=c.DisbVous[h].Partial;break}if(e==k.length-1){g.push(c.DisbVous[h]);break}}}}}}}}d=d.concat(k.concat(g));return d};return new function(){this.open=function(){if(a===undefined){a=new b();a.Open();Gwt.Core.Contrib.SetActiveApp(window.accountingrep)}else{console.log("%app yet opened".replace("%app",a.__proto__.constructor.name))}};this.close=function(){if(a!==undefined){a.Close();a=undefined;Gwt.Core.Contrib.RemoveActiveApp()}}}})();