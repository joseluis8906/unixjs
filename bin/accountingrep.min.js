accountingrep=(function(){var a;function b(){Gwt.Gui.Window.call(this,"Reporte");this.SetSize(640,320);this.SetPosition(Gwt.Gui.WIN_POS_CENTER);this.SetBorderSpacing(12);this.Rpc=new Gwt.Core.Rpc("/accountingrep/");this.EnableMenu();this.AddMenuItem(Gwt.Core.Contrib.Images+"appbar.printer.svg","Imprimir",this.Print.bind(this));this.AddMenuItem(Gwt.Core.Contrib.Images+"appbar.power.svg","Salir",function(){window.accountingrep.close();window.gcontrol.open()},Gwt.Gui.MENU_QUIT_APP);this.layout=new Gwt.Gui.VBox();this.SetLayout(this.layout);this.ReportType=new Gwt.Gui.IconSelectBox(Gwt.Core.Contrib.Images+"appbar.notification.star.svg","Tipo de Reporte",[{Text:"Comprobante de Diario",Value:"Daily"}]);this.layout.Add(this.ReportType);this.labelDateBegin=new Gwt.Gui.StaticText("Desde");this.labelDateBegin.SetExpand(true);this.layout.Add(this.labelDateBegin);this.dateBegin=new Gwt.Gui.Date("Inicio");this.dateBegin.Now();this.layout.Add(this.dateBegin);this.labelDateEnd=new Gwt.Gui.StaticText("Hasta");this.labelDateBegin.SetExpand(true);this.layout.Add(this.labelDateEnd);this.dateEnd=new Gwt.Gui.Date("Final");this.dateEnd.Now();this.layout.Add(this.dateEnd);this.Report=null}b.prototype=new Gwt.Gui.Window();b.prototype.constructor=b;b.prototype._App=function(){this.labelDateBegin._StaticText();this.dateBegin._Date();this.labelDateEnd._StaticText();this.dateEnd._Date();this.Report===null?null:this.Report.close();this.layout._VBox();this.labelDateBegin=null;this.dateBegin=null;this.labelDateEnd=null;this.dateEnd=null;this.layout=null;this.Report=null};b.prototype.CreateData=function(){var c={Method:this.ReportType.GetText(),DateBegin:this.dateBegin.GetText(),DateEnd:this.dateEnd.GetText()};return c};b.prototype.Print=function(){var c=this.CreateData();this.Rpc.Send(c,this.PrintResponse.bind(this))};b.prototype.PrintResponse=function(c){console(this.SortData(c))};b.prototype.ReportLoad=function(){var h=this.Report.contentWindow.document;h.getElementById("Number").textContent=Gwt.Core.Contrib.ZFill(this.number.GetText(),4);h.getElementById("Date").textContent=this.date.GetText();h.getElementById("Concept").textContent=this.concept.GetText();var d=0;var g=0;var c=[];for(var e=0;e<this.records.length;e++){if(this.records[e].code.GetText()!==""){d+=Number(this.records[e].debit.GetText());g+=Number(this.records[e].credit.GetText());c.push({Code:this.records[e].code.GetText(),Name:this.records[e].name.GetText(),Partial:Gwt.Core.Contrib.TextToMonetary(this.records[e].partial.GetText()),Debit:Gwt.Core.Contrib.TextToMonetary(this.records[e].debit.GetText()),Credit:Gwt.Core.Contrib.TextToMonetary(this.records[e].credit.GetText())})}}var f=this.SortData(c);for(var e=0;e<f.length;e++){h.getElementById("Code"+e).textContent=f[e].Code;h.getElementById("Name"+e).textContent=f[e].Name;h.getElementById("Partial"+e).textContent=(f[e].Partial==="$0")?"":f[e].Partial;h.getElementById("Debit"+e).textContent=(f[e].Debit==="$0")?"":f[e].Debit;h.getElementById("Credit"+e).textContent=(f[e].Credit==="$0")?"":f[e].Credit}h.getElementById("EqSumDebit").textContent=Gwt.Core.Contrib.TextToMonetary(d.toString());h.getElementById("EqSumCredit").textContent=Gwt.Core.Contrib.TextToMonetary(g.toString());h=undefined;this.Report=null;this.Reset()};b.prototype.Reset=function(){this.ReportType.SetText("");this.dateBegin.SetText("");this.dateEnd.Now()};b.prototype.SortData=function(c){var k=[];var g=[];var d=[];if(c.Notes.length>0){var f;for(var h=0;h<c.Notes.length;h++){if(Number(c.Notes[h].Debit)!==0){for(var e=0;e<k.length;e++){if(c.Notes[h].Code===k[e].Code){k[e].Debit+=c.Notes[h].Debit;break}if(e==k.length-1){k.push(c.Notes[h]);break}}f="Debit"}else{if(Number(c.Notes[h].Credit)!==0){for(var e=0;e<g.length;e++){if(c.Notes[h].Code===g[e].Code){g[e].Credit+=c.Notes[h].Credit;break}if(e==k.length-1){g.push(c.Notes[h]);break}}f="Credit"}else{if(f==="Debit"){for(var e=0;e<k.length;e++){if(c.Notes[h].Code===k[e].Code){k[e].Debit+=c.Notes[h].Debit;break}if(e==k.length-1){k.push(c.Notes[h]);break}}}else{if(f==="Credit"){for(var e=0;e<g.length;e++){if(c.Notes[h].Code===g[e].Code){g[e].Credit+=c.Notes[h].Credit;break}if(e==k.length-1){g.push(c.Notes[h]);break}}}}}}}}d=k.concat(g);return d};return new function(){this.open=function(){if(a===undefined){a=new b();a.Open();Gwt.Core.Contrib.SetActiveApp(window.accountingrep)}else{console.log("%app yet opened".replace("%app",a.__proto__.constructor.name))}};this.close=function(){if(a!==undefined){a.Close();a=undefined;Gwt.Core.Contrib.RemoveActiveApp()}}}})();