cedeg=(function(){var b;function c(e,f){Gwt.Gui.HBox.call(this,0);this.SetSize(e,f);this.SetClassName("record_widget");this.Rpc=new Gwt.Core.Rpc("/cedeg/");this.code=new Gwt.Gui.Entry("Código");this.code.SetExpand(false);this.code.SetWidth(120);this.name=new Gwt.Gui.StaticText("Nombre");this.name.SetExpand(false);this.name.SetWidth(this.GetWidth()-360);this.name.SetValign(Gwt.Gui.Contrib.Valign.Middle);this.debit=new Gwt.Gui.Entry("Debe");this.debit.SetExpand(false);this.debit.SetWidth(120);this.debit.ChangeToMonetary();this.debit.TextAlign(Gwt.Gui.Contrib.TextAlign.Right);this.credit=new Gwt.Gui.Entry("Haber");this.credit.SetExpand(false);this.credit.SetWidth(120);this.credit.ChangeToMonetary();this.credit.TextAlign(Gwt.Gui.Contrib.TextAlign.Right);this.Add(this.code);this.Add(this.name);this.Add(this.debit);this.Add(this.credit);this.code.AddEvent(Gwt.Gui.Event.Keyboard.KeyPress,this.check_code.bind(this))}c.prototype=new Gwt.Gui.HBox();c.prototype.constructor=c;c.prototype._record_widget=function(){this.code._Entry();this.name._StaticText();this.debit._Entry();this.credit._Entry();this.code=null;this.name=null;this.debit=null;this.credit=null};c.prototype.Reset=function(){this.code.Reset();this.name.SetText("Nombre");this.debit.Reset();this.credit.Reset()};c.prototype.check_code=function(e){if(e.keyCode===Gwt.Gui.Event.Keyboard.KeyCodes.Enter){this.Rpc.Send({Method:"CheckCode",Code:this.code.GetText()},this.autocomplete.bind(this))}};c.prototype.autocomplete=function(e){if(e.length>0){this.name.SetText(e[0].Name)}else{this.name.SetText("Nombre")}};function d(e,f){Gwt.Gui.VBox.call(this,0);this.SetSize(e,f);this.SetClassName("equal_sums_widget");this.label1=new Gwt.Gui.StaticText("Sumas Iguales");this.label1.SetExpand(false);this.label1.SetWidth(this.GetWidth()-240);this.label1.SetValign(Gwt.Gui.Contrib.Valign.Top);this.label1.TextAlign(Gwt.Gui.Contrib.TextAlign.Right);this.debit=new Gwt.Gui.Entry("Debe");this.debit.SetExpand(false);this.debit.SetWidth(120);this.debit.ChangeToMonetary();this.debit.TextAlign(Gwt.Gui.Contrib.TextAlign.Right);this.debit.SetValign(Gwt.Gui.Contrib.Valign.Top);this.credit=new Gwt.Gui.Entry("Haber");this.credit.SetExpand(false);this.credit.SetWidth(120);this.credit.ChangeToMonetary();this.credit.TextAlign(Gwt.Gui.Contrib.TextAlign.Right);this.credit.SetValign(Gwt.Gui.Contrib.Valign.Top);this.Row1=new Gwt.Gui.HBox(0);this.Row1.SetExpand(false);this.Row1.SetSize(e,24);this.Row1.Add(this.label1);this.Row1.Add(this.debit);this.Row1.Add(this.credit);this.Add(this.Row1);this.label2=new Gwt.Gui.StaticText(" ");this.label2.SetExpand(false);this.label2.SetWidth(this.GetWidth()-240);this.label2.SetValign(Gwt.Gui.Contrib.Valign.Top);this.label2.TextAlign(Gwt.Gui.Contrib.TextAlign.Right);this.dif_debit=new Gwt.Gui.Entry(" ");this.dif_debit.SetExpand(false);this.dif_debit.SetWidth(120);this.dif_debit.ChangeToMonetary();this.dif_debit.TextAlign(Gwt.Gui.Contrib.TextAlign.Right);this.dif_debit.SetValign(Gwt.Gui.Contrib.Valign.Top);this.dif_credit=new Gwt.Gui.Entry(" ");this.dif_credit.SetExpand(false);this.dif_credit.SetWidth(120);this.dif_credit.ChangeToMonetary();this.dif_credit.TextAlign(Gwt.Gui.Contrib.TextAlign.Right);this.dif_credit.SetValign(Gwt.Gui.Contrib.Valign.Top);this.Row2=new Gwt.Gui.HBox(0);this.Row2.SetExpand(false);this.Row2.SetSize(e,24);this.Row2.Add(this.label2);this.Row2.Add(this.dif_debit);this.Row2.Add(this.dif_credit);this.Add(this.Row2)}d.prototype=new Gwt.Gui.VBox();d.prototype.constructor=d;d.prototype.set_debit=function(e){if(e===0){this.debit.SetText("Debe")}else{this.debit.SetText(e)}this.verify_equality()};d.prototype.set_credit=function(e){if(e===0){this.credit.SetText("Haber")}else{this.credit.SetText(e)}this.verify_equality()};d.prototype.verify_equality=function(){var e=Number(this.debit.GetText());var f=Number(this.credit.GetText());if(e<f){this.debit.SetColor(new Gwt.Gui.Contrib.Color(Gwt.Gui.Contrib.Colors.Red));this.credit.SetColor(new Gwt.Gui.Contrib.Color(Gwt.Gui.Contrib.Colors.Azure));this.label2.SetText("Faltante");this.dif_credit.SetText("");this.dif_debit.SetText(f-e)}else{if(e>f){this.debit.SetColor(new Gwt.Gui.Contrib.Color(Gwt.Gui.Contrib.Colors.Azure));this.credit.SetColor(new Gwt.Gui.Contrib.Color(Gwt.Gui.Contrib.Colors.Red));this.label2.SetText("Faltante");this.dif_debit.SetText("");this.dif_credit.SetText(e-f)}else{this.debit.SetColor(new Gwt.Gui.Contrib.Color(Gwt.Gui.Contrib.Colors.Azure));this.credit.SetColor(new Gwt.Gui.Contrib.Color(Gwt.Gui.Contrib.Colors.Azure));this.label2.SetText("");this.dif_debit.SetText("");this.dif_credit.SetText("")}}};d.prototype.Reset=function(){this.debit.SetText("Debe");this.credit.SetText("Haber");this.dif_debit.SetText("");this.dif_credit.SetText("");this.label2.SetText("")};function a(){Gwt.Gui.Window.call(this,"Comprobante De Egreso");this.SetSize(840,524);this.SetPosition(Gwt.Gui.WIN_POS_CENTER);this.SetBorderSpacing(12);this.Rpc=new Gwt.Core.Rpc("/cedeg/");this.EnableMenu();this.AddMenuItem(Gwt.Core.Contrib.Images+"appbar.cabinet.in.svg","Guardar",this.Insert.bind(this));this.AddMenuItem(Gwt.Core.Contrib.Images+"appbar.refresh.svg","Actualizar",this.Update.bind(this));this.AddMenuItem(Gwt.Core.Contrib.Images+"appbar.delete.svg","Eliminar",this.Delete.bind(this));this.AddMenuItem(Gwt.Core.Contrib.Images+"appbar.printer.svg","Imprimir",this.Print.bind(this));this.AddMenuItem(Gwt.Core.Contrib.Images+"appbar.power.svg","Salir",function(){window.gcontrol.open()},Gwt.Gui.MENU_QUIT_APP);this.layout=new Gwt.Gui.VBox();this.SetLayout(this.layout);this.slider=new Gwt.Gui.Slider(3);this.slider.SetSize(this.layout.GetWidth(),this.layout.GetHeight()-64);this.slider.Setup();this.number=new Gwt.Gui.Entry("Número");this.place=new Gwt.Gui.Entry("Lugar");this.date=new Gwt.Gui.Date("Creación");this.date.SetWidth(256);this.date.Now();this.holder=new Gwt.Gui.Entry("A Favor De");this.amount=new Gwt.Gui.Entry("Valor");this.amount.ChangeToMonetary();this.bank=new Gwt.Gui.Entry("Banco");this.check=new Gwt.Gui.Entry("Cheque");this.checking_account=new Gwt.Gui.Entry("Cuenta");this.concept=new Gwt.Gui.Text("Concepto");this.records=[];this.update=false;this.Report=null;this.Accounts=null;this.Accounts=new Gwt.Core.Rpc("/cuentas/");this.layout.Add(this.slider);this.equal_sums=new d(this.layout.GetWidth(),48);this.layout.Add(this.equal_sums);for(var e=0;e<20;e++){this.records[e]=new c(this.slider.GetWidth(),24);this.records[e].debit.AddEvent(Gwt.Gui.Event.Form.Change,this.ChangeDebit.bind(this));this.records[e].credit.AddEvent(Gwt.Gui.Event.Form.Change,this.ChangeCredit.bind(this))}this.slider.AddSlotWidget(0,this.number);this.slider.AddSlotWidget(0,this.place);this.slider.AddSlotWidget(0,this.date);this.slider.AddSlotWidget(0,this.holder);this.slider.AddSlotWidget(0,this.amount);this.slider.AddSlotWidget(0,this.bank);this.slider.AddSlotWidget(0,this.check);this.slider.AddSlotWidget(0,this.checking_account);this.slider.AddSlotWidget(0,this.concept);for(var e=0;e<this.records.length;e++){if(e<=9){this.slider.AddSlotWidget(1,this.records[e])}else{this.slider.AddSlotWidget(2,this.records[e])}}this.number.AddEvent(Gwt.Gui.Event.Keyboard.KeyPress,this.CheckNumber.bind(this));this.Accounts.Send({Method:"SelectBase"},this.LoadAccounts.bind(this))}a.prototype=new Gwt.Gui.Window();a.prototype.constructor=a;a.prototype._App=function(){this.number._Entry();this.place._Entry();this.date._Date();this.holder._Entry();this.amount._Entry();this.bank._Entry();this.check._Entry();this.checking_account._Entry();this.concept._Text();this.slider._Slider();this.Report===null?0:this.Report.close();this.Accounts=null;this.number=null;this.place=null;this.date=null;this.holder=null;this.amount=null;this.bank=null;this.check=null;this.checking_account=null;this.concept=null;this.slider=null;for(var e=0;e<this.records.length;e++){this.records[e]._record_widget();this.records[e]=null}this.records=null;this.layout._VBox();this.layout=null;this.Report=null};a.prototype.LoadAccounts=function(e){this.Accounts=e};a.prototype.ChangeDebit=function(){var e=0;for(var f=0;f<this.records.length;f++){e+=Number(this.records[f].debit.GetText())}this.equal_sums.set_debit(e)};a.prototype.ChangeCredit=function(){var e=0;for(var f=0;f<this.records.length;f++){e+=Number(this.records[f].credit.GetText())}this.equal_sums.set_credit(e)};a.prototype.CreateData=function(){var f={Number:this.number.GetText(),Place:this.place.GetText(),Date:this.date.GetText(),Holder:this.holder.GetText(),Concept:this.concept.GetText(),Bank:this.bank.GetText(),Check:this.check.GetText(),CheckingAccount:this.checking_account.GetText(),Amount:this.amount.GetText()};f.Records=[];for(var e=0;e<this.records.length;e++){if(this.records[e].code.GetText()!==""){f.Records.push({Debit:(this.records[e].debit.GetText()==="")?0:this.records[e].debit.GetText(),Credit:(this.records[e].credit.GetText()==="")?0:this.records[e].credit.GetText(),Number:this.number.GetText(),Code:this.records[e].code.GetText()})}}return f};a.prototype.Insert=function(){var e=this.CreateData();e.Method="Insert";this.Rpc.Send(e,this.InsertResponse.bind(this))};a.prototype.InsertResponse=function(e){if(e.affected_rows===1){this.Print()}};a.prototype.Update=function(e){var f=this.CreateData();f.Method="Update";this.Rpc.Send(f,this.UpdateResponse.bind(this))};a.prototype.UpdateResponse=function(e){if(e.affected_rows===1){this.Print()}};a.prototype.Delete=function(){this.Rpc.Send({Method:"Delete",Number:this.number.GetText()},this.DeleteResponse.bind(this))};a.prototype.DeleteResponse=function(e){if(e.affected_rows===1){this.Reset()}};a.prototype.Print=function(e){this.Report=Gwt.Core.Contrib.LoadDocument("/documents/cedeg.html");this.Report.addEventListener("load",this.ReportLoad.bind(this))};a.prototype.Reset=function(){this.number.SetText("");this.place.SetText("");this.date.Now();this.holder.SetText("");this.amount.SetText("");this.bank.SetText("");this.check.SetText("");this.checking_account.SetText("");this.concept.SetText("");for(var e=0;e<this.records.length;e++){this.records[e].Reset()}this.equal_sums.Reset()};a.prototype.CheckNumber=function(e){if(e.keyCode===Gwt.Gui.Event.Keyboard.KeyCodes.Enter){if(this.number.GetText()===""){this.Rpc.Send({Method:"NextNumber"},this.NextNumber.bind(this))}else{this.Rpc.Send({Method:"AutoFill",Number:this.number.GetText()},this.AutoFill.bind(this))}}};a.prototype.AutoFill=function(e){if(e.length>0){this.number.SetText(e[0].Number);this.place.SetText(e[0].Place);this.date.SetDate(e[0].Date);this.holder.SetText(e[0].Holder);this.amount.SetText(e[0].Amount);this.bank.SetText(e[0].Bank);this.check.SetText(e[0].Check);this.checking_account.SetText(e[0].CheckingAccount);this.concept.SetText(e[0].Concept);for(var f=0;f<e.length;f++){this.records[f].code.SetText(e[f].Code);this.records[f].name.SetText(e[f].Name);this.records[f].debit.SetText((e[f].Debit===0?"":e[f].Debit));this.records[f].credit.SetText((e[f].Credit===0?"":e[f].Credit))}for(f;f<this.records.length;f++){this.records[f].Reset()}}else{this.Reset()}this.ChangeDebit();this.ChangeCredit()};a.prototype.NextNumber=function(e){if(e.length>0){this.number.SetText(Number(e[0].Number)+1)}else{this.number.SetText(Number(1))}};a.prototype.SortData=function(e){var l=[];var m=[];var k=[];var g=[];for(var h=0;h<e.length;h++){if(Number(e[h].Debit)!==0){k.push(e[h])}else{if(Number(e[h].Credit)!==0){g.push(e[h])}}}for(var h=0;h<k.length;h++){for(var f=0;f<this.Accounts.length;f++){this.Accounts[f].Debit=0;this.Accounts[f].Credit=0;this.Accounts[f].Partial=0;if(k[h].Code.startsWith(this.Accounts[f].Code)){if(l.indexOf(this.Accounts[f])<0){l.push(this.Accounts[f])}}}}for(var h=0;h<g.length;h++){for(var f=0;f<this.Accounts.length;f++){this.Accounts[f].Debit=0;this.Accounts[f].Credit=0;this.Accounts[f].Partial=0;if(g[h].Code.startsWith(this.Accounts[f].Code)){if(m.indexOf(this.Accounts[f])<0){m.push(this.Accounts[f])}}}}for(var h=0;h<k.length;h++){for(var f=0;f<l.length;f++){if(k[h].Code.startsWith(l[f].Code)){l[f].Debit=l[f].Debit+Number(k[h].Debit);k[h].Partial=k[h].Debit;k[h].Debit=0}}}for(var h=0;h<g.length;h++){for(var f=0;f<m.length;f++){if(g[h].Code.startsWith(m[f].Code)){m[f].Credit=m[f].Credit+g[h].Credit;g[h].Partial=g[h].Credit;g[h].Credit=0}}}Sorted=[];k=l.concat(k);k=k.sortByKey("Code");g=m.concat(g);g=g.sortByKey("Code");Sorted=Sorted.concat(k).concat(g);return Sorted};a.prototype.ReportLoad=function(){var h=this.Report.document;h.getElementById("Number").textContent=Gwt.Core.Contrib.ZFill(this.number.GetText(),4);h.getElementById("Place").textContent=this.place.GetText()+", "+this.date.GetText();h.getElementById("Holder").textContent=this.holder.GetText();h.getElementById("AmountHuman").textContent=Gwt.Core.Contrib.NumberToHumanReadable(this.amount.GetText())+"PESOS MTE";h.getElementById("Bank").textContent=this.bank.GetText();h.getElementById("Check").textContent=this.check.GetText();h.getElementById("CheckingAccount").textContent=this.checking_account.GetText();h.getElementById("Concept").textContent=this.concept.GetText();h.getElementById("Amount").textContent=Gwt.Core.Contrib.TextToMonetary(this.amount.GetText());var e=[];for(var f=0;f<this.records.length;f++){if(this.records[f].code.GetText()!==""){e.push({Code:this.records[f].code.GetText(),Name:this.records[f].name.GetText(),Debit:Number(this.records[f].debit.GetText()),Credit:Number(this.records[f].credit.GetText())})}}var g=this.SortData(e);for(var f=0;f<g.length;f++){h.getElementById("Code"+f).textContent=g[f].Code;h.getElementById("Name"+f).textContent=g[f].Name;h.getElementById("Partial"+f).textContent=(g[f].Partial===0)?"":Gwt.Core.Contrib.TextToMonetary(String(g[f].Partial));h.getElementById("Debit"+f).textContent=(g[f].Debit===0)?"":Gwt.Core.Contrib.TextToMonetary(String(g[f].Debit));h.getElementById("Credit"+f).textContent=(g[f].Credit===0)?"":Gwt.Core.Contrib.TextToMonetary(String(g[f].Credit))}for(f;f<this.records.length;f++){h.getElementById("Code"+f).textContent="";h.getElementById("Name"+f).textContent="";h.getElementById("Partial"+f).textContent="";h.getElementById("Debit"+f).textContent="";h.getElementById("Credit"+f).textContent=""}h=undefined;this.Report=null;this.Reset()};return new function(){this.open=function(){if(b===undefined){b=new a();b.Open()}else{console.log("%app yet opened".replace("%app",b.__proto__.constructor.name))}};this.close=function(){if(b!==undefined){b.Close();b=undefined}}}})();